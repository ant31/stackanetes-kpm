{
  set_vars(dependency, vars):: (
    local variables = if std.objectHas(self.default_vars(vars), dependency.name) == true then
        self.default_vars(vars)[dependency.name]
      else
        { };

    dependency { variables: variables }
  ),

  default_vars(env): {
    local this = self,

    local deployment = {
      replicas: 1,
      image: {
        base: env.image_base,
      },
    },

    local network = {
      external_ips: env.external_ips,
      ingress: {
        enabled: env.ingress_enabled,
        host: env.ingress_host,
        port: env.ingress_port,
      },
    },

    local database = {
      address: "mariadb",
      port: 3306,
      root_user: "root",
      root_password: "password",
    },

    local rados_gateway = {
      enabled: env.ceph_enabled,
      swift_user: "glance:swift",
      ceph_admin_keyring: env.ceph_admin_keyring,
      ceph_monitors: env.ceph_monitors,
      secret_uuid: env.ceph_rbd_secret_uuid,
    },

    local rabbitmq = {
      admin_user: "rabbitmq",
      admin_password: "password",
    },

    local keystone = {
      admin_user: "admin",
      admin_password: "password",
      admin_project_name: "admin",
      admin_region_name: "RegionOne",
    },

    local neutron = {
      metadata_secret: "password",
    },

    local misc = {
      workers: 8,
      debug: false,
    },

    // Data plane.
    "quentinm/mariadb": {
      deployment: deployment,
      network: network,
    } + database,

    "quentinm/rabbitmq": {
      deployment: deployment,
      network: network,
    } + rabbitmq,

    "quentinm/memcached": {
      deployment: deployment,
      network: network,
    },

    "quentinm/rados-gateway": {
      deployment: deployment,
      network: network,
      database: database,
      keystone: keystone,
      misc: misc,
    } + rados_gateway,

    // OpenStack services.
    "quentinm/keystone": {
      deployment: deployment,
      network: network,
      database: database,
      misc: misc,
    } + keystone,

    "quentinm/glance": {
      deployment: deployment,
      network: network,
      database: database,
      keystone: keystone,
      rados_gateway: rados_gateway,
      misc: misc,
    },

    "quentinm/cinder": {
      deployment: deployment,
      network: network,
      database: database,
      keystone: keystone,
      rados_gateway: rados_gateway,
      rabbitmq: rabbitmq,
      misc: misc,
    },

    "quentinm/nova": {
      deployment: deployment,
      network: network,
      database: database,
      keystone: keystone,
      rados_gateway: rados_gateway,
      rabbitmq: rabbitmq,
      neutron: neutron,
      misc: misc,
    },

    "quentinm/horizon": {
      deployment: deployment,
      network: network,
      keystone: keystone,
      misc: misc,
    },
  },
}
