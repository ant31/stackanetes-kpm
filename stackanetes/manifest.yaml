---
package:
  name: quentinm/stackanetes
  author: Quentin Machu
  version: 0.1.0
  description: stackanetes
  license: Apache 2.0

variables:
  ############### #
  # CONFIGURATION #
  ############### #

  external_ips:
    - 192.168.0.201

  ceph_enabled: true
  ceph_monitors:
    - 192.168.0.207
    - 192.168.0.209
    - 192.168.0.211
  ceph_admin_keyring: "AQCW84RXpk6mERAA9hfAIKzV1uwYC5C1ogN4QA=="

  ######################
  # SUBPACKAGE MAPPING #
  ######################

  glance:
    ceph_enabled: "{{ ceph_enabled }}"
    ceph_admin_keyring: "{{ ceph_admin_keyring }}"

  rados_gateway:
    external_ips: {{ external_ips }}
    ceph_monitors: {{ ceph_monitors }}
    ceph_admin_keyring: "{{ ceph_admin_keyring }}"

deploy:
  # Control plane.
  ## Data services.
  - name: kpm.sh/quentinm/mariadb
    variables: "{{$.variables}}"

  - name: kpm.sh/quentinm/rabbitmq
    variables: "{{$.variables}}"

  - name: kpm.sh/quentinm/memcached
    variables: "{{$.variables}}"

  {%- if ceph_enabled -%}
  - name: kpm.sh/quentinm/rados-gateway
    variables: "{{$.variables.rados_gateway}}"
  {%- endif -%}

  ## OpenStack APIs services.
  - name: kpm.sh/quentinm/keystone
    variables: "{{$.variables}}"

  - name: kpm.sh/quentinm/glance
    variables: "{{$.variables.glance}}"
