apiVersion: v1
kind: ConfigMap
metadata:
  namespace: {{ variables.deployment.namespace }}
  name: keystone-wsgikeystone
data:
  wsgi-keystone.conf: |-
    Listen {{ variables.network.ip_address }}:{{ variables.network.port.public }}
    Listen {{ variables.network.ip_address }}:{{ variables.network.port.admin }}

    <VirtualHost *:{{ variables.network.port.public }}>
        WSGIDaemonProcess keystone-public processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}
        WSGIProcessGroup keystone-public
        WSGIScriptAlias / /var/www/cgi-bin/keystone/main
        WSGIApplicationGroup %{GLOBAL}
        WSGIPassAuthorization On
        <IfVersion >= 2.4>
          ErrorLogFormat "%{cu}t %M"
        </IfVersion>
        ErrorLog "|$/bin/cat 1>&2"
        CustomLog "|/bin/cat" combined
    </VirtualHost>

    <VirtualHost *:{{ variables.network.port.admin }}>
        WSGIDaemonProcess keystone-admin processes=5 threads=1 user=keystone group=keystone display-name=%{GROUP}
        WSGIProcessGroup keystone-admin
        WSGIScriptAlias / /var/www/cgi-bin/keystone/admin
        WSGIApplicationGroup %{GLOBAL}
        WSGIPassAuthorization On
        <IfVersion >= 2.4>
          ErrorLogFormat "%{cu}t %M"
        </IfVersion>
        ErrorLog "|$/bin/cat 1>&2"
        CustomLog "|/bin/cat" combined
    </VirtualHost>
